name: Playwright Tests
on:
  workflow_dispatch:
    inputs:
      browser:
        description: 'Select Browser'
        required: true
        default: 'all'
        type: choice
        options:
          - all
          - chromium
          - firefox
          - webkit
      parallel:
        description: 'Run in Parallel?'
        required: true
        default: 'true'
        type: choice
        options:
          - 'true'
          - 'false'
      workers:
        description: 'Number of Workers (e.g., 1, 2, 5)'
        required: true
        default: '3'
        type: string

jobs:
  test:
    timeout-minutes: 60
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-node@v4
      with:
        node-version: 18
        cache: 'npm'

    - name: Install dependencies
      run: npm ci

    - name: Install Playwright Browsers
      run: npx playwright install --with-deps

    - name: Run Playwright tests
      run: |
        # Logic to handle browser selection
        BROWSER_FLAG=""
        if [ "${{ github.event.inputs.browser }}" != "all" ]; then
          BROWSER_FLAG="--project=${{ github.event.inputs.browser }}"
        fi

        # Logic to handle parallelism
        PARALLEL_FLAG=""
        if [ "${{ github.event.inputs.parallel }}" == "false" ]; then
          PARALLEL_FLAG="--fully-parallel=false"
        else
          PARALLEL_FLAG="--fully-parallel=true"
        fi

        # Execute Command
        npx playwright test $BROWSER_FLAG $PARALLEL_FLAG --workers=${{ github.event.inputs.workers }}
      env:
        CI: true

    - name: Upload Shareable Allure Report
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: allure-report-single-file
        path: testAssets/artifacts/allure-report/index.html